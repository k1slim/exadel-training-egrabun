define("stat",["jquery","lodash"],function(e,t){var n=function(){this.numberOfAnswQuest=1,this.rightAnsw=0,this.wrongAnsw=0,this.quizzes=[]};return n.prototype.statItems={NUMBER:1,RIGHT:2,WRONG:3},n.prototype.getStats=function(){return{right:this.rightAnsw,wrong:this.wrongAnsw,number:this.numberOfAnswQuest}},n.prototype.getToStatsModule=function(e,t,n){this.rightAnsw=e,this.wrongAnsw=t,this.numberOfAnswQuest=n},n.prototype.getToStatsModuleQuizzes=function(e){this.quizzes=e},n.prototype.resetStats=function(){this.numberOfAnswQuest=1,this.rightAnsw=0,this.wrongAnsw=0},n.prototype.increaseParameter=function(e){switch(e){case 1:++this.numberOfAnswQuest;break;case 2:++this.rightAnsw;break;case 3:++this.wrongAnsw}},n.prototype.updateStats=function(t,n){e("#numb").html(this.numberOfAnswQuest),e("#rightAnswerCounter").html(this.rightAnsw),e("#wrongAnswerCounter").html(this.wrongAnsw),e("#numbLast").html(t.questions.length),e("#activeQuest").html(parseInt(n,10)+1)},n.prototype.updatePassedTestMarker=function(){t.forEach(this.quizzes,function(t){var n=e("#"+t+"test");n.html().indexOf("✔")===-1?n.append("  ✔"):!1})},n.prototype.markPassedTest=function(e){this.quizzes===undefined&&(this.quizzes=[]),this.quizzes.push(e),this.quizzes=t.uniq(this.quizzes),this.updatePassedTestMarker()},new n}),define("persistence",[],function(){var e=function(){this.stat={},this.actQuest=-1,this.actTest=-1,this.answArray=[],this.passedTest=[],this.parseLocalStorage()};return e.prototype.getToPersModule=function(e,t,n,r,i){this.stat=e,this.actQuest=t,this.actTest=n,this.answArray=r,this.passedTest=i},e.prototype.pushToLocalStorage=function(){localStorage.setItem("quizzer",JSON.stringify(this))},e.prototype.checkLocalStorage=function(){return localStorage.quizzer},e.prototype.parseLocalStorage=function(){if(this.checkLocalStorage()){var e=JSON.parse(localStorage.getItem("quizzer"));this.getToPersModule(e.stat,e.actQuest,e.actTest,e.answArray,e.passedTest)}else this.getToPersModule({},-1,-1,[],[])},new e}),define("routing",[],function(){var e=function(){this.actQuest=-1,this.actTest=-1,this.parseUrl()};return e.prototype.getToRouter=function(e,t){this.actQuest=e,this.actTest=t},e.prototype.pushToURL=function(){var e=this.actTest+1,t=this.actQuest+1;window.location.hash="#test/"+e+"/"+t+"/"},e.prototype.clearUrl=function(){window.location.hash="",this.getToRouter(-1,-1)},e.prototype.parseUrl=function(){this.checkUrl()?this.getToRouter(this.checkUrl()[2]-1,this.checkUrl()[1]-1):this.getToRouter(-1,-1)},e.prototype.checkUrl=function(){var e=/#test\/([0-9]{1})\/([0-9]{1,2})\/?/;return window.location.hash.match(e)},e.prototype.urlValidation=function(e){if(this.checkUrl()[1]>e.length||parseInt(this.checkUrl()[1],10)===0)this.actTest=0;if(this.checkUrl()[2]>e[this.actTest].questions.length||parseInt(this.checkUrl()[2],10)===0)this.actQuest=0},new e}),define("util",["jquery"],function(e){var t={};return t.showAlertWindow=function(t,n){n==="show"?(e("#alertWindow").show(),e("#alertWindowBack").show()):(e("#alertWindow").hide(),e("#alertWindowBack").hide()),e("#textPlaceholder").html(t)},t}),define("text!../template/templateQuest.hbs",[],function(){return'<div id="placeQuestionText">\n    {{question}}\n</div>\n{{#if questionImg}}\n    <img id="placeImage" src={{questionImg}} />\n{{/if}}\n<ul>\n    {{#each answers}}\n        <li class="answ">\n\n        </li>\n    {{/each}}\n</ul>\n<div id="skip">\n    Пропустить вопрос\n</div>'}),define("test",["jquery","lodash","handlebars","stat","persistence","routing","util","text!../template/templateQuest.hbs"],function(e,t,n,r,i,s,o,u){var a=function(){this.contenerWithQuestion=e(".textQuest"),this.popUpCloseButton=e("#closedAlertWindow"),this.backButton=e("#back"),this.activeQuestion=0,this.answArr=[]};return a.prototype.placeQuestions=function(e){var t=n.compile(u);this.contenerWithQuestion.html(t(e.questions[this.activeQuestion])),this.changeId(e),this.lockAnswers(this.activeQuestion,this.answArr),r.updateStats(e,this.activeQuestion)},a.prototype.changeResources=function(e){i.getToPersModule(r.getStats(),this.activeQuestion,e,this.answArr,r.quizzes),i.pushToLocalStorage(),s.getToRouter(this.activeQuestion,e),s.pushToURL()},a.prototype.determineAnswNumber=function(e,t,n){e.target.id!=="skip"&&(r.increaseParameter(r.statItems.NUMBER),t.questions[this.activeQuestion].answered=1,this.answArr.push(this.activeQuestion),parseInt(e.target.id,10)+1===parseInt(t.questions[this.activeQuestion].right,10)?r.increaseParameter(r.statItems.RIGHT):(r.increaseParameter(r.statItems.WRONG),o.showAlertWindow(t.questions[this.activeQuestion].question+"<br /><br />Вы ответили:<br />"+t.questions[this.activeQuestion].answers[parseInt(e.target.id,10)]+"<br /><br />Правильный ответ:<br />"+t.questions[this.activeQuestion].answers[t.questions[this.activeQuestion].right-1],"show")));if(e.target.id==="skip"||parseInt(e.target.id,10)+1===parseInt(t.questions[this.activeQuestion].right,10))this.activeQuestion=this.logicOfQuestions(t,this.activeQuestion),this.changeResources(n),r.numberOfAnswQuest===t.questions.length+1&&this.returnToMainPage(t,n)},a.prototype.logicOfQuestions=function(e,t){var n=!1,i;if(r.numberOfAnswQuest!==e.questions.length+1){i=t<0||t>=e.questions.length-1?0:++t;for(i;i<e.questions.length;i++)if(!e.questions[i].answered){n=!0,t=i;break}n===!1&&(t=this.logicOfQuestions(e,t))}return t},a.prototype.returnToMainPage=function(t,n){r.numberOfAnswQuest===t.questions.length+1&&(r.rightAnsw>=r.numberOfAnswQuest-2?(o.showAlertWindow("Молодeц ,правильных ответов - "+r.rightAnsw+"/"+(r.numberOfAnswQuest-1)+".<br />Тест сдан!","show"),r.markPassedTest(n)):o.showAlertWindow("Не молодeц ,правильных ответов - "+r.rightAnsw+"/"+(r.numberOfAnswQuest-1)+".<br />Тест не сдан!","show")),e("#leftBlock").show(),e("#question").hide(),e("#back").hide(),e("#info").hide(),this.activeQuestion=0,r.resetStats(),r.updateStats(t,this.activeQuestion),this.answArr=[];for(var u=0;u<t.questions.length;u++)delete t.questions[u].answered;i.getToPersModule({},-1,-1,[],r.quizzes),i.pushToLocalStorage(),s.clearUrl()},a.prototype.defineClosedButtonAction=function(e,t){r.numberOfAnswQuest===e.questions.length+1?this.returnToMainPage(e,t):(r.numberOfAnswQuest!==1&&(this.activeQuestion=this.logicOfQuestions(e,this.activeQuestion),this.changeResources(t)),o.showAlertWindow())},a.prototype.changeId=function(n){var r=t.range(5);r.length=n.questions[this.activeQuestion].answers.length;var i=t.shuffle(r);for(var s=0;s<i.length;s++)this.contenerWithQuestion.find("li")[s].setAttribute("id",i[s]+"answ"),e("#"+i[s]+"answ").html(n.questions[this.activeQuestion].answers[i[s]])},a.prototype.getToTestModule=function(e,t){this.activeQuestion=e,this.answArr=t},a.prototype.lockAnswers=function(t,n){for(var r=0;r<n.length;r++)if(t===n[r])for(var i=0;i<5;i++){var s=e("#"+i+"answ");s.removeClass("answ"),s.addClass("lock")}},new a}),define("text!../template/templateListTest.hbs",[],function(){return'<ul>\n    {{#each test}}\n        <li id={{@index}}test class="testStr">\n            {{title}}\n        </li>\n    {{/each}}\n</ul>'}),define("constructor",["jquery","lodash","handlebars","test","stat","persistence","routing","text!../template/templateListTest.hbs"],function(e,t,n,r,i,s,o,u){var a=function(){this.contenerWithTests=e(".listTest"),this.clearButton=e("#clear"),this.numberOfTest=-1,this.data={}};return a.prototype.openTest=function(){e("#leftBlock").hide(),e("#question").show(),e("#back").show(),e("#info").show(),r.changeResources(this.numberOfTest)},a.prototype.determineTestNumber=function(e){this.numberOfTest=parseInt(e.target.id,10),this.openTest()},a.prototype.init=function(){var e=this;this.getData("js/json/data.json",function(t){e.data=t})},a.prototype.startApp=function(){var e=this,t=n.compile(u);this.contenerWithTests.html(t({test:this.data})),window.addEventListener("hashchange",function(){o.parseUrl(),e.pushDataToApp()}),this.contenerWithTests.on("click",".testStr",function(t){e.determineTestNumber(t)}),r.contenerWithQuestion.on("click",".answ, #skip",function(t){r.determineAnswNumber(t,e.data[e.numberOfTest],e.numberOfTest)}),r.popUpCloseButton.on("click",function(){r.defineClosedButtonAction(e.data[e.numberOfTest],e.numberOfTest)}),r.backButton.on("click",function(){r.returnToMainPage(e.data[e.numberOfTest],e.numberOfTest)}),this.clearButton.on("click",function(){localStorage.removeItem("quizzer")}),this.pushDataToApp(),(s.actTest!==-1||o.actQuest!==-1)&&this.openTest()},a.prototype.getData=function(t,n){var r=this;e.getJSON(t,function(e){n(e),r.startApp()})},a.prototype.pushDataToApp=function(){i.getToStatsModuleQuizzes(s.passedTest),i.updatePassedTestMarker();if(s.actTest!==-1){this.getToConst(s.actTest),i.getToStatsModule(s.stat.right,s.stat.wrong,s.stat.number),r.getToTestModule(s.actQuest,s.answArray);for(var t=0;t<r.answArr.length;t++)this.data[this.numberOfTest].questions[r.answArr[t]].answered=1}o.actQuest!==-1&&(o.urlValidation(this.data),this.getToConst(o.actTest),r.activeQuestion=o.actQuest),s.actTest!==-1&&o.actTest!==-1&&o.actTest!==s.actTest&&(i.resetStats(),r.answArr=[],s.getToPersModule({},-1,-1,[],i.quizzes),s.pushToLocalStorage());if(s.actTest!==-1||o.actQuest!==-1)e("#leftBlock").hide(),e("#question").show(),e("#back").show(),e("#info").show(),e("#titlePlaceholder").html(this.data[this.numberOfTest].title),r.placeQuestions(this.data[this.numberOfTest],this.numberOfTest)},a.prototype.getToConst=function(e){this.numberOfTest=e},new a}),require.config({paths:{jquery:"lib/jquery.min",handlebars:"lib/handlebars.min",lodash:"lib/lodash.min",text:"lib/text.min",constructor:"constructor",test:"test",stat:"stat",persistence:"persistence",routing:"routing",util:"util"},shim:{handlebars:{exports:"Handlebars"}}}),require(["constructor"],function(e){e.init()}),define("init",function(){});